# ðŸš€ Codiner Publishing Guide

This guide details the exact steps to build, sign, and distribute **Codiner** as a professional production product.

## 1. Prerequisites
- **GitHub Account:** For hosting the repository and releases.
- **Apple Developer Program:** ($99/year) Required for macOS Notarization.
- **Standard/EV Code Signing Certificate:** Required for Windows (prevents "SmartScreen" warnings).
- **DigiCert KeyLocker (Recommended):** High-security cloud-based HSM for signing.

## 2. GitHub Secrets Setup
To enable the automated build pipeline (`.github/workflows/release.yml`), add these secrets to your GitHub Repository:

| Secret Name | Description |
|-------------|-------------|
| `GITHUB_TOKEN` | Automatically provided by GitHub. |
| `APPLE_ID` | Your Apple ID email. |
| `APPLE_PASSWORD` | An [App-Specific Password](https://appleid.apple.com). |
| `APPLE_TEAM_ID` | Your 10-character Team ID from member center. |
| `SM_CODE_SIGNING_CERT_SHA1` | The thumbprint of your Windows certificate. |

## 3. Production Build Commands

### Local Testing
```bash
# Package the app locally for your current OS
npm run package

# Generate installers/executables (out/make)
npm run make
```

### Triggering a Release
The pipeline is set to trigger when you push a version tag:
```bash
# 1. Update version in package.json (0.32.0 -> 0.33.0)
# 2. Tag the commit
git tag v0.33.0
git push origin v0.33.0
```
This will start the GitHub Action, build for all platforms, and create a **Draft Release** on GitHub.

## 4. Microsoft Store Strategy
You have two options for the Store:

### Option A: The "Direct Link" (Easiest)
Simply submit your `Setup.exe` (Squirrel) generated by `npm run make`. Select "Desktop app" in the Partner Center. Microsoft will download from your GitHub release.

### Option B: The MSIX Bridge (Recommended for deep integration)
1. Install `electron-windows-store` (`npm install -g electron-windows-store`).
2. Convert your package: `electron-windows-store --input-directory out/codiner-win32-x64 --output-directory out/msix`.
3. This creates an `.appinstaller` file that is native to the Windows Store.

## 5. Security & Rollbacks
- **Versioning:** Always use Semantic Versioning. `update-electron-app` uses this to detect if a newer version is available on GitHub.
- **Rollback:** If v0.33.0 is buggy, simply delete the release and the tag, and push a new v0.34.0 based on the previous stable commit. The auto-updater will pick it up instantly.

## 6. Troubleshooting
- **Codesigning errors:** Ensure `DigiCert KeyLocker` or `Certum` tools are in the PATH on your build machine (or the CI runner if using self-hosted).
- **Asar Integrity:** We have enabled ASAR integrity in `forge.config.ts`. If you modify any file inside the `.asar` after signing, the app will refuse to launch (prevents tampering).
